name: Validate Documentation

on:
  push:
    branches: [ main, develop, feature/* ]
  pull_request:
    branches: [ main, develop ]

jobs:
  validate-docs:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Run document validation
      run: |
        echo "Running document validation..."
        node scripts/validate-constraints.js
    
    - name: Upload validation results
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: validation-results
        path: |
          validation-report.json
          validation-summary.txt
        retention-days: 7
    
    - name: Comment PR with validation results
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          let comment = '## ğŸ“‹ æ–‡æ¡£éªŒè¯ç»“æœ\n\n';
          
          try {
            const results = JSON.parse(fs.readFileSync('validation-report.json', 'utf8'));
            comment += `âœ… é€šè¿‡: ${results.passed}\n`;
            comment += `âŒ å¤±è´¥: ${results.failed}\n`;
            comment += `âš ï¸ è­¦å‘Š: ${results.warnings}\n\n`;
            
            if (results.errors && results.errors.length > 0) {
              comment += '### é”™è¯¯\n';
              results.errors.forEach(error => {
                comment += `- ${error}\n`;
              });
              comment += '\n';
            }
            
            if (results.warnings && results.warnings.length > 0) {
              comment += '### è­¦å‘Š\n';
              results.warnings.forEach(warning => {
                comment += `- ${warning}\n`;
              });
            }
          } catch (e) {
            comment += 'æ— æ³•è¯»å–éªŒè¯ç»“æœ\n';
          }
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });