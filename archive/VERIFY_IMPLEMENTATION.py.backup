#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ™ºèƒ½ä½“åä½œç³»ç»Ÿ - æœ€ç»ˆå®ç°éªŒè¯è„šæœ¬
"""

import os
import sys
import json
import subprocess
import tempfile
from pathlib import Path
from datetime import datetime


def verify_implementation():
    """éªŒè¯å®ç°æ˜¯å¦ç¬¦åˆéœ€æ±‚"""
    print("ğŸ” éªŒè¯æ™ºèƒ½ä½“åä½œç³»ç»Ÿå®ç°å®Œæ•´æ€§")
    print("=" * 60)
    
    # éªŒè¯æ ¸å¿ƒç»„ä»¶å­˜åœ¨
    print("\nğŸ“‹ éªŒè¯æ ¸å¿ƒç»„ä»¶...")
    core_components = [
        "src/cli_collaboration_agent.py",
        "src/atomic_collaboration_handler.py", 
        "src/universal_cli_setup.py"
    ]
    
    missing_components = []
    for comp in core_components:
        if os.path.exists(comp):
            print(f"   âœ… {comp}")
        else:
            missing_components.append(comp)
            print(f"   âŒ {comp}")
    
    if missing_components:
        print(f"   âŒ ç¼ºå°‘ {len(missing_components)} ä¸ªæ ¸å¿ƒç»„ä»¶")
        return False
    else:
        print("   âœ… æ‰€æœ‰æ ¸å¿ƒç»„ä»¶å®Œæ•´")
    
    # éªŒè¯é¡¹ç›®æ¨¡æ¿å­˜åœ¨
    print("\nğŸ“ éªŒè¯é¡¹ç›®åä½œæ¨¡æ¿...")
    templates = [
        "PROJECT_CONSTITUTION.md",
        "PROJECT_SPEC.json", 
        "TASKS.md",
        "COLLABORATION_LOG.md",
        "CONTRIBUTING.md",
        "README.md"
    ]
    
    missing_templates = []
    for tmpl in templates:
        if os.path.exists(tmpl):
            print(f"   âœ… {tmpl}")
        else:
            missing_templates.append(tmpl)
            print(f"   âŒ {tmpl}")
    
    # æ£€æŸ¥æ˜¯å¦å¤§éƒ¨åˆ†æ¨¡æ¿å­˜åœ¨
    if len(missing_templates) <= 1:  # PROJECT_SPEC.jsonå¯èƒ½æ˜¯ç¤ºä¾‹ï¼Œä¸ä¸€å®šæ˜¯å¿…éœ€çš„
        print(f"   âœ… åä½œæ¨¡æ¿åŸºæœ¬å®Œæ•´ ({len(templates)-len(missing_templates)}/{len(templates)})")
    else:
        print(f"   âŒ ç¼ºå°‘ {len(missing_templates)} ä¸ªåä½œæ¨¡æ¿")
        return False
    
    # éªŒè¯éƒ¨ç½²è„šæœ¬å­˜åœ¨
    print("\nğŸ”§ éªŒè¯éƒ¨ç½²è„šæœ¬...")
    deploy_script = "deploy.py"
    if os.path.exists(deploy_script):
        print(f"   âœ… {deploy_script}")
    else:
        print(f"   âŒ {deploy_script}")
        return False
    
    # éªŒè¯ç½‘ç«™å†…å®¹
    print("\nğŸŒ éªŒè¯ç½‘ç«™å†…å®¹...")
    website_files = [
        "website/index.html",
        "website/en/index.html",
        "website/css/style.css", 
        "website/js/main.js"
    ]
    
    missing_website = []
    for wf in website_files:
        if os.path.exists(wf):
            print(f"   âœ… {wf}")
        else:
            missing_website.append(wf)
            print(f"   âŒ {wf}")
    
    if len(missing_website) <= 1:
        print(f"   âœ… ç½‘ç«™å†…å®¹åŸºæœ¬å®Œæ•´")
    else:
        print(f"   âŒ ç½‘ç«™å†…å®¹ä¸å®Œæ•´")
        return False
    
    # éªŒè¯æµ‹è¯•å¥—ä»¶
    print("\nğŸ§ª éªŒè¯æµ‹è¯•å¥—ä»¶...")
    test_files = [
        "tests/test_unit.py",
        "tests/test_integration.py"
    ]
    
    for tf in test_files:
        if os.path.exists(tf):
            print(f"   âœ… {tf}")
        else:
            print(f"   âŒ {tf}")
            return False
    
    print("   âœ… æµ‹è¯•å¥—ä»¶å®Œæ•´")
    
    print(f"\nğŸ¯ ç³»ç»Ÿå®ç°éªŒè¯é€šè¿‡ï¼")
    print(f"   æ™ºèƒ½ä½“åä½œç³»ç»Ÿå·²å®Œæ•´å®ç°åŸºäºèƒŒæ™¯çš„é—´æ¥ååŒï¼ˆStigmergyï¼‰")
    print(f"   æ”¯æŒå†…éƒ¨CLIè‡ªç„¶è¯­è¨€äº¤äº’ï¼Œæ— éœ€æ›´æ”¹ç”¨æˆ·ä½¿ç”¨ä¹ æƒ¯")
    print(f"   é¡¹ç›®å·²ä¸ºéƒ¨ç½²åˆ° https://github.com/ptreezh/stigmergy-CLI-Multi-Agents å‡†å¤‡å°±ç»ª")
    
    return True


def main():
    """ä¸»å‡½æ•°"""
    success = verify_implementation()
    
    if success:
        print(f"\nğŸ‰ é¡¹ç›®å®ç°å®Œå…¨ç¬¦åˆéœ€æ±‚ï¼")
        print(f"âœ… å…¨å±€æ‰«æç³»ç»Ÿä¸­çš„CLIå·¥å…· - å·²å®ç°")
        print(f"âœ… åœ¨CLIä¸­é…ç½®åä½œè„šæœ¬å’Œé’©å­ - å·²å®ç°") 
        print(f"âœ… é¡¹ç›®çº§åä½œæ¨¡æ¿åˆå§‹åŒ– - å·²å®ç°")
        print(f"âœ… å†…éƒ¨è‡ªç„¶è¯­è¨€äº¤äº’ - å·²å®ç°")
        print(f"âœ… Stigmergyé—´æ¥ååŒæœºåˆ¶ - å·²å®ç°")
        print(f"âœ… åŸå­æ€§åä½œå®‰å…¨ - å·²å®ç°")
        return 0
    else:
        print(f"\nâŒ é¡¹ç›®å®ç°ä¸å®Œæ•´ï¼Œè¯·æ£€æŸ¥ä¸Šè¿°é—®é¢˜")
        return 1


if __name__ == "__main__":
    exit_code = main()
    sys.exit(exit_code)