# Stigmergy 协同模式可视化对比

## 三种模式对比

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                        STIGMERGY 协同模式对比                              ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────┐
│ 1. PARALLEL MODE (并行模式)                                                  │
│ ──────────────────────────────────────────────────────────────────────────── │
│                                                                              │
│   输入: "解释闭包概念"                                                       │
│                                                                              │
│      ┌────────┐      ┌────────┐      ┌────────┐                            │
│      │  Qwen  │      │ iFlow  │      │ Claude │                            │
│      └───┬────┘      └───┬────┘      └───┬────┘                            │
│          │               │               │                                  │
│          └───────────────┴───────────────┘                                  │
│                    ↓                                                         │
│            "解释闭包概念"                                                     │
│                    ↓                                                         │
│          ┌─────────────────────┐                                             │
│          │  Result Aggregator  │                                             │
│          │  (投票/共识策略)      │                                             │
│          └─────────┬───────────┘                                             │
│                    ↓                                                         │
│         选择: 最相似/多数的结果                                                 │
│                                                                              │
│   特点: ✅ 快速验证  ✅ 多数决策  ⚠️ 可能有重复工作                          │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│ 2. COMPETITIVE MODE (竞争模式)                                                │
│ ──────────────────────────────────────────────────────────────────────────── │
│                                                                              │
│   输入: "实现斐波那契函数"                                                     │
│                                                                              │
│      ┌────────┐      ┌────────┐      ┌────────┐                            │
│      │  Qwen  │      │ iFlow  │      │ Claude │                            │
│      └───┬────┘      └───┬────┘      └───┬────┘                            │
│          │               │               │                                  │
│          └───────────────┴───────────────┘                                  │
│                    ↓                                                         │
│          "实现斐波那契函数"                                                   │
│                    ↓                                                         │
│      ┌─────────────────────────────────┐                                     │
│      │     Quality Scoring System      │                                     │
│      │  ┌─────────────────────────┐   │                                     │
│      │  │ • 输出完整性  (40%)     │   │                                     │
│      │  │ • 代码规范    (20%)     │   │                                     │
│      │  │ • 文档详尽度  (15%)     │   │                                     │
│      │  │ • 执行效率    (15%)     │   │                                     │
│      │  │ • CLI权重    (10%)     │   │                                     │
│      │  └─────────────────────────┘   │                                     │
│      └─────────────────┬───────────────┘                                     │
│                        ↓                                                   │
│              选择: 最高分的结果                                                │
│                                                                              │
│   特点: ✅ 质量保证  ✅ 唯一最佳  ⚠️ 需要评分标准                            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│ 3. COLLABORATIVE MODE (协同模式)                                              │
│ ──────────────────────────────────────────────────────────────────────────── │
│                                                                              │
│   输入: "开发用户认证系统"                                                    │
│                                                                              │
│              Task Decomposer                                                 │
│                    ↓                                                         │
│      ┌─────────────────────────────────┐                                     │
│      │  任务分析: "开发用户认证系统"     │                                     │
│      │  类型: code + security + testing│                                     │
│      └─────────────────────────────────┘                                     │
│                    ↓                                                         │
│     ┌──────────────┬──────────────┬──────────────┐                          │
│     │              │              │              │                          │
│     ↓              ↓              ↓              ↓                          │
│ ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐                       │
│ │ Claude │    │  Qwen  │    │ iFlow  │    │Copilot │                       │
│ │┌──────┐│    │┌──────┐│    │┌──────┐│    │┌──────┐│                       │
│ ││设计  ││    ││实现  ││    ││安全  ││    ││最佳  ││                       │
│ ││接口  ││    ││代码  ││    ││分析  ││    ││实践  ││                       │
│ │└──────┘│    │└──────┘│    │└──────┘│    │└──────┘│                       │
│ └────────┘    └────────┘    └────────┘    └────────┘                       │
│     │              │              │              │                          │
│     └──────────────┴──────────────┴──────────────┘                          │
│                    ↓                                                         │
│      ┌─────────────────────────────────┐                                     │
│      │   Intelligent Result Merger     │                                     │
│      │  (智能合并互补的输出)            │                                     │
│      └─────────────────────────────────┘                                     │
│                    ↓                                                         │
│            完整的认证系统解决方案                                              │
│            (设计 + 代码 + 安全 + 测试)                                        │
│                                                                              │
│   特点: ✅ 互补工作  ✅ 避免重复  ✅ 完整方案                                 │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## 工作流程对比

```
PARALLEL:         Task → All CLIs → Aggregator → Best Result
                          (相同任务)

COMPETITIVE:      Task → All CLIs → Scoring → Winner
                          (竞争质量)

COLLABORATIVE:    Task → Decomposer → Sub-tasks → Specialists → Merger
                          (互补合作)
```

## 协同效率对比

```
任务复杂度  │  Parallel  │ Competitive │ Collaborative
───────────┼─────────────┼─────────────┼──────────────
   简单     │    ⭐⭐⭐    │    ⭐⭐      │     ⭐
   中等     │    ⭐⭐      │    ⭐⭐⭐    │     ⭐⭐
   复杂     │    ⭐       │    ⭐⭐      │    ⭐⭐⭐

资源利用率 │    ⭐⭐      │    ⭐⭐⭐    │    ⭐⭐⭐
结果质量   │    ⭐⭐      │    ⭐⭐⭐    │    ⭐⭐⭐
协同效率   │    ⭐       │    ⭐⭐      │    ⭐⭐⭐
```

## 间接协同的信息流

```
┌─────────────────────────────────────────────────────────────────┐
│                    Stigmergy 环境层                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Stigmergy Environment (共享状态)                        │   │
│  │  • File Modifications (文件修改痕迹)                      │   │
│  │  • Task Assignments (任务分配记录)                        │   │
│  │  • Result Cache (结果缓存)                               │   │
│  │  • Conflicts (冲突检测)                                  │   │
│  │  • Metrics (协同指标)                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
         ↑                                      ↓
    感知环境                              留下痕迹
         │                                      │
┌────────┴────────┐                    ┌────────┴────────┐
│                 │                    │                 │
│   Qwen Agent    │                    │   iFlow Agent   │
│                 │                    │                 │
│  readTraces()   │                    │  addTrace()     │
│                 │                    │                 │
└─────────────────┘                    └─────────────────┘
```

## 冲突避免机制

```
场景: 两个CLI同时想修改同一文件

时间线:
─────────────────────────────────────────────────────────────

T1: Qwen 想修改 utils.js
    ↓
    fileLockManager.acquireLock('utils.js', 'qwen')
    ✅ 成功获取锁

T2: iFlow 想修改 utils.js
    ↓
    fileLockManager.acquireLock('utils.js', 'iflow')
    ❌ 失败 (文件被 qwen 锁定)
    ↓
    iflow 感知到 qwen 正在修改
    → 等待 或 修改其他文件

T3: Qwen 完成修改
    ↓
    fileLockManager.releaseLock('utils.js', 'qwen')
    ✅ 释放锁

T4: iFlow 可以获取锁
    ↓
    fileLockManager.acquireLock('utils.js', 'iflow')
    ✅ 成功获取锁

─────────────────────────────────────────────────────────────

结果: ✅ 无冲突，顺序修改
```

## 协同效果示例

### 示例1: 代码生成 (Competitive)

```javascript
输入: "实现一个LRU缓存"

竞争:
├─ Qwen: 85分 (完整实现，有注释)
├─ iFlow: 78分 (简洁实现，无注释)
└─ Claude: 92分 (完整实现，有测试，有文档)

胜出: Claude 的实现 (92分)

最终输出: Claude的LRU缓存实现
```

### 示例2: 系统设计 (Collaborative)

```javascript
输入: "设计一个微服务架构"

协同分解:
├─ Claude: 设计服务拆分和通信协议
├─ Qwen: 实现API网关代码
├─ iFlow: 分析性能瓶颈
└─ Copilot: 补充最佳实践

智能合并:
完整的微服务架构方案
  ├── 架构设计文档 (Claude)
  ├── API网关实现 (Qwen)
  ├── 性能优化建议 (iFlow)
  └── 最佳实践指南 (Copilot)
```

### 示例3: 快速验证 (Parallel)

```javascript
输入: "这个函数是否有bug?"

并行执行:
├─ Qwen: "没有明显bug" ✅
├─ iFlow: "建议添加边界检查" ⚠️
└─ Claude: "存在潜在空指针问题" ❌

共识分析:
├─ {Claude, iFlow} → 2票 (有潜在问题)
└─ {Qwen} → 1票 (无问题)

结论: 存在潜在问题，需要修复
```

## 总结

### 三种模式的选择指南

```
需求                    推荐模式              理由
─────────────────────────────────────────────────
快速得到一个答案        →  Parallel            → 多数投票，快速
需要最高质量的代码      →  Competitive         → 质量评分，择优
复杂系统开发            →  Collaborative       → 互补协同，完整
验证想法                →  Parallel            → 多角度验证
生成单一最佳方案        →  Competitive         → 竞争选择最优
需要完整解决方案        →  Collaborative       → 任务分解，合并
```

### 关键优势

1. **间接协同**：无需CLI间直接通信
2. **避免冲突**：文件锁 + 环境感知
3. **智能聚合**：多种策略适应不同场景
4. **自动恢复**：失败重试 + 会话恢复
5. **可扩展**：易于添加新CLI和策略
