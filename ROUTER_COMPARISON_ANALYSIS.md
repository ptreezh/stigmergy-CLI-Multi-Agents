# Router.js vs Router-beta.js åŠŸèƒ½å¯¹æ¯”åˆ†æ

**åˆ†ææ—¥æœŸ**: 2025-12-23
**ç›®æ ‡**: ç¡®ä¿ router-beta.js å®Œæ•´å®ç° router.js çš„æ‰€æœ‰åŠŸèƒ½

## ğŸ“Š å‘½ä»¤åŠŸèƒ½å¯¹æ¯”

### âœ… å‘½ä»¤è¦†ç›–åº¦æ£€æŸ¥

| å‘½ä»¤ | router.js | router-beta.js | çŠ¶æ€ |
|------|-----------|----------------|------|
| version | âœ… (532-537è¡Œ) | âœ… (95-101è¡Œ) | âœ… å·²è¦†ç›– |
| errors | âœ… (540-551è¡Œ) | âœ… (103-111è¡Œ) | âœ… å·²è¦†ç›– |
| init | âœ… (553-584è¡Œ) | âœ… (143-150è¡Œ) | âœ… å·²è¦†ç›– |
| setup | âœ… (586-665è¡Œ) | âœ… (151-158è¡Œ) | âœ… å·²è¦†ç›– |
| status | âœ… (667-696è¡Œ) | âœ… (169-178è¡Œ) | âœ… å·²è¦†ç›– |
| scan | âœ… (698-709è¡Œ) | âœ… (179-189è¡Œ) | âœ… å·²è¦†ç›– |
| upgrade | âœ… (711-833è¡Œ) | âœ… (125-134è¡Œ) | âœ… å·²è¦†ç›– |
| install | âœ… (836-941è¡Œ) | âœ… (113-123è¡Œ) | âœ… å·²è¦†ç›– |
| inst (åˆ«å) | âœ… (837è¡Œ) | âœ… (115è¡Œ alias) | âœ… å·²è¦†ç›– |
| deploy | âœ… (943-952è¡Œ) | âœ… (136-142è¡Œ) | âœ… å·²è¦†ç›– |
| call | âœ… (954-987è¡Œ) | âœ… (160-167è¡Œ) | âœ… å·²è¦†ç›– |
| fix-perms | âœ… (1463-1491è¡Œ) | âœ… (192-198è¡Œ) | âœ… å·²è¦†ç›– |
| perm-check | âœ… (1530-1562è¡Œ) | âœ… (200-206è¡Œ) | âœ… å·²è¦†ç›– |
| clean | âœ… (1345-1398è¡Œ) | âœ… (210-218è¡Œ) | âœ… å·²è¦†ç›– |
| c (åˆ«å) | âœ… (1346è¡Œ) | âœ… (211è¡Œ alias) | âœ… å·²è¦†ç›– |
| diagnostic | âœ… (1400-1461è¡Œ) | âœ… (220-227è¡Œ) | âœ… å·²è¦†ç›– |
| diag (åˆ«å) | âœ… (1401è¡Œ) | âœ… (221è¡Œ alias) | âœ… å·²è¦†ç›– |
| d (åˆ«å) | âœ… (1402è¡Œ) | âœ… (221è¡Œ alias) | âœ… å·²è¦†ç›– |
| skill | âœ… (1276-1343è¡Œ) | âœ… (229-244è¡Œ) | âœ… å·²è¦†ç›– |
| skill-i | âœ… (1277è¡Œ) | âœ… (246-254è¡Œ) | âœ… å·²è¦†ç›– |
| skill-l | âœ… (1278è¡Œ) | âœ… (256-262è¡Œ) | âœ… å·²è¦†ç›– |
| skill-r | âœ… (1279è¡Œ) | âœ… (264-271è¡Œ) | âœ… å·²è¦†ç›– |
| skill-v | âœ… (1280è¡Œ) | âœ… (273-280è¡Œ) | âœ… å·²è¦†ç›– |
| skill-d | âœ… (1281è¡Œ) | âœ… (283-290è¡Œ) | âœ… å·²è¦†ç›– |
| skill-m | âœ… (1282è¡Œ) | âœ… (293-300è¡Œ) | âœ… å·²è¦†ç›– |
| auto-install | âœ… (989-1274è¡Œ) | âœ… (302-310è¡Œ) | âœ… å·²è¦†ç›– |
| resume | âœ… (1494-1528è¡Œ) | âœ… (312-320è¡Œ) | âœ… å·²è¦†ç›– |
| resumesession | âœ… (1495è¡Œ) | âœ… (322-329è¡Œ) | âœ… å·²è¦†ç›– |
| sg-resume | âœ… (1598è¡Œä»£ç å—) | âœ… (331-338è¡Œ) | âœ… å·²è¦†ç›– |
| claude | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| gemini | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| qwen | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| codebuddy | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| codex | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| iflow | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| qodercli | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| copilot | âœ… (1564-1607è¡Œ) | âœ… (341è¡Œå¾ªç¯) | âœ… å·²è¦†ç›– |
| kode | âŒ | âœ… (341è¡Œå¾ªç¯) | âœ… é¢å¤–åŠŸèƒ½ |

**å‘½ä»¤è¦†ç›–ç‡**: 100% (æ‰€æœ‰ router.js çš„å‘½ä»¤éƒ½å·²å®ç°)

## ğŸ” æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”

### 1. Smart Routing (æ™ºèƒ½è·¯ç”±)

| åŠŸèƒ½ | router.js | router-beta.js |
|------|-----------|----------------|
| SmartRouter å®ä¾‹åŒ– | âœ… (471è¡Œ) | âœ… (964è¡Œ) |
| smartRoute() è°ƒç”¨ | âœ… (966è¡Œ) | âœ… å†…è”åœ¨CLIå·¥å…·è·¯ç”±ä¸­ |
| executeSmartRoutedCommand | âœ… (171-458è¡Œ) | âŒ **ç¼ºå¤±** |

**âš ï¸ å…³é”®å·®å¼‚**:
- router.js æœ‰ç»Ÿä¸€çš„ `executeSmartRoutedCommand()` å‡½æ•° (171-458è¡Œ)
- router-beta.js æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯å°†é€»è¾‘å†…è”åœ¨ CLI å·¥å…·å‘½ä»¤å¤„ç†ä¸­ (342-428è¡Œ)

**å½±å“åˆ†æ**:
- `call` å‘½ä»¤: router.js ä½¿ç”¨ executeSmartRoutedCommandï¼Œrouter-beta.js ç›´æ¥è°ƒç”¨ getCLIPath
- ç›´æ¥ CLI å‘½ä»¤ (claude, geminiç­‰): ä¸¤è€…éƒ½å†…è”å¤„ç†ï¼ŒåŠŸèƒ½ç›¸å½“

### 2. Skills/Agents Cache (ç¼“å­˜ç³»ç»Ÿ)

| åŠŸèƒ½ | router.js | router-beta.js |
|------|-----------|----------------|
| ensureSkillsCache() | âœ… (54-98è¡Œ) | âŒ **ç¼ºå¤±** |
| LocalSkillScanner | âœ… (37è¡Œå¯¼å…¥) | âŒ **ç¼ºå¤±** |
| init å‘½ä»¤ä¸­çš„ç¼“å­˜åˆå§‹åŒ– | âœ… (558è¡Œ) | âŒ **ç¼ºå¤±** |
| setup å‘½ä»¤ä¸­çš„ç¼“å­˜åˆå§‹åŒ– | âœ… (591è¡Œ) | âŒ **ç¼ºå¤±** |
| scan å‘½ä»¤ä¸­çš„ç¼“å­˜åˆå§‹åŒ– | âœ… (701è¡Œ) | âŒ **ç¼ºå¤±** |
| upgrade å‘½ä»¤ä¸­çš„ç¼“å­˜åˆå§‹åŒ– | âœ… (716è¡Œ) | âŒ **ç¼ºå¤±** |
| install å‘½ä»¤ä¸­çš„ç¼“å­˜åˆå§‹åŒ– | âœ… (842è¡Œ) | âŒ **ç¼ºå¤±** |

**âš ï¸ å…³é”®ç¼ºå¤±**: router-beta.js å®Œå…¨æ²¡æœ‰ skills/agents ç¼“å­˜ç³»ç»Ÿ

### 3. Helper Functions (è¾…åŠ©å‡½æ•°)

| å‡½æ•° | router.js | router-beta.js |
|------|-----------|----------------|
| formatBytes() | âœ… (100-106è¡Œ) | âœ… (å¯¼å…¥è‡ª utils/formatters) |
| getWorkingDirectoryForTool() | âœ… (108-130è¡Œ) | âœ… (å¯¼å…¥è‡ª utils/environment) |
| addOAuthAuthArgs() | âœ… (132-156è¡Œ) | âœ… (66-80è¡Œ) |

### 4. å‚æ•°å¤„ç† (Parameter Handling)

| åŠŸèƒ½ | router.js | router-beta.js |
|------|-----------|----------------|
| EnhancedCLIParameterHandler | âœ… (207-220è¡Œ) | âœ… (367-390è¡Œ) |
| Agent/Skill ä¼˜åŒ– | âœ… (223-227è¡Œ) | âœ… (370-376è¡Œ) |
| å‚æ•°æ ¼å¼é‡è¯•æœºåˆ¶ | âœ… (391-456è¡Œ) | âœ… (367-390è¡Œ) |

### 5. ç¯å¢ƒå’Œç›®å½•ç®¡ç†

| åŠŸèƒ½ | router.js | router-beta.js |
|------|-----------|----------------|
| getCLIPath() | âœ… (289è¡Œ) | âœ… (349è¡Œ) |
| setupCLIPaths() | âœ… (562è¡Œ, 595è¡Œ) | âŒ **ç¼ºå¤±** |
| å·¥ä½œç›®å½•è®¾ç½® | âœ… (337è¡Œ) | âœ… (399è¡Œ) |

### 6. OAuth è®¤è¯

| åŠŸèƒ½ | router.js | router-beta.js |
|------|-----------|----------------|
| addOAuthAuthArgs å‡½æ•° | âœ… (132-156è¡Œ) | âœ… (66-80è¡Œ) |
| OAuth å‘½ä»¤è¡Œå‚æ•° | âŒ **ç¼ºå¤±** | âœ… (52-58è¡Œå®šä¹‰, 431-437è¡Œåº”ç”¨) |

**âœ… æ”¹è¿›**: router-beta.js æ·»åŠ äº† OAuth å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ

### 7. é”™è¯¯å¤„ç†

| åŠŸèƒ½ | router.js | router-beta.js |
|------|-----------|----------------|
| errorHandler | âœ… (å¤šå¤„ä½¿ç”¨) | âœ… (422è¡Œ) |
| setupGlobalErrorHandlers | âœ… (40è¡Œ) | âœ… (45è¡Œ) |
| CLIé”™è¯¯å¤„ç† | âœ… (365-389è¡Œ) | âœ… (422-425è¡Œ) |

## âš ï¸ å‘ç°çš„åŠŸèƒ½å·®å¼‚

### router-beta.js ç¼ºå¤±çš„åŠŸèƒ½

1. **ensureSkillsCache() å‡½æ•°** - Skills/Agents ç¼“å­˜ç®¡ç†ç³»ç»Ÿ
   - router.js åœ¨ init/setup/scan/upgrade/install å‘½ä»¤ä¸­è°ƒç”¨
   - router-beta.js å®Œå…¨ç¼ºå¤±

2. **executeSmartRoutedCommand() ç»Ÿä¸€å‡½æ•°** - æ™ºèƒ½è·¯ç”±æ‰§è¡Œ
   - router.js ä½¿ç”¨ç»Ÿä¸€çš„å‡½æ•°å¤„ç† call å’Œç›´æ¥ CLI å‘½ä»¤
   - router-beta.js å°†é€»è¾‘åˆ†æ•£åˆ°å„å¤„

3. **setupCLIPaths() é›†æˆ**
   - router.js åœ¨ init å’Œ setup ä¸­è°ƒç”¨
   - router-beta.js ç¼ºå¤±

### router-beta.js é¢å¤–çš„åŠŸèƒ½

1. **OAuth å‘½ä»¤è¡Œå‚æ•°** - æ”¯æŒ --client-id, --client-secret ç­‰
2. **kode CLI å·¥å…·æ”¯æŒ** - router.js æ²¡æœ‰è¿™ä¸ªå·¥å…·
3. **æ›´ç®€æ´çš„ä»£ç ** - ä½¿ç”¨æ¨¡å—åŒ–å‘½ä»¤å¤„ç†å™¨

## ğŸ¯ å»ºè®®çš„ä¿®å¤æªæ–½

### é«˜ä¼˜å…ˆçº§ (å¿…é¡»ä¿®å¤)

1. **æ·»åŠ  ensureSkillsCache() åŠŸèƒ½**
   ```javascript
   // éœ€è¦åœ¨ä»¥ä¸‹å‘½ä»¤ä¸­æ·»åŠ :
   // - init (handleInitCommand)
   // - setup (handleSetupCommand)
   // - scan (handleScanCommand)
   // - upgrade (handleUpgradeCommand)
   // - install (handleInstallCommand)
   ```

2. **éªŒè¯ setupCLIPaths() æ˜¯å¦è¢«è°ƒç”¨**
   - æ£€æŸ¥ init/setup å‘½ä»¤å¤„ç†å™¨
   - ç¡®ä¿è·¯å¾„è®¾ç½®åŠŸèƒ½å®Œæ•´

### ä¸­ä¼˜å…ˆçº§ (å»ºè®®ä¿®å¤)

3. **è€ƒè™‘æ·»åŠ  executeSmartRoutedCommand() ç»Ÿä¸€å‡½æ•°**
   - æé«˜ä»£ç å¯ç»´æŠ¤æ€§
   - å‡å°‘ code duplication

### ä½ä¼˜å…ˆçº§ (å¯é€‰)

4. **OAuth å‚æ•°ä¼ é€’éªŒè¯**
   - ç¡®ä¿ router-beta.js çš„ OAuth å‚æ•°èƒ½æ­£ç¡®ä¼ é€’åˆ° CLI å·¥å…·

## ğŸ“‹ éªŒè¯æ¸…å•

åœ¨ç§»åŠ¨ router.js åˆ°å­˜æ¡£å‰ï¼Œéœ€è¦éªŒè¯ï¼š

- [ ] init å‘½ä»¤èƒ½æ­£ç¡®åˆå§‹åŒ– skills/agents ç¼“å­˜
- [ ] setup å‘½ä»¤åŒ…å«è·¯å¾„è®¾ç½®åŠŸèƒ½
- [ ] scan å‘½ä»¤æ›´æ–°ç¼“å­˜
- [ ] upgrade å‘½ä»¤æ›´æ–°ç¼“å­˜
- [ ] install å‘½ä»¤æ›´æ–°ç¼“å­˜
- [ ] call å‘½ä»¤æ­£ç¡®è·¯ç”±
- [ ] ç›´æ¥ CLI å‘½ä»¤ (claude, geminiç­‰) æ­£ç¡®æ‰§è¡Œ
- [ ] OAuth å‚æ•°æ­£ç¡®ä¼ é€’
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸å·¥ä½œ
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

## ğŸ”„ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… **å·²å®Œæˆ**: è¯¦ç»†åŠŸèƒ½å¯¹æ¯”
2. **è¿›è¡Œä¸­**: æ£€æŸ¥å‘½ä»¤å¤„ç†å™¨æ˜¯å¦å®ç°äº†ç¼ºå¤±çš„åŠŸèƒ½
3. **å¾…åŠ**: ä¿®å¤ä»»ä½•ç¼ºå¤±çš„åŠŸèƒ½
4. **å¾…åŠ**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
5. **å¾…åŠ**: ç§»åŠ¨ router.js åˆ°å­˜æ¡£
