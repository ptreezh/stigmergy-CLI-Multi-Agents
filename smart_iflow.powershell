# æ™ºèƒ½iflowè·¯ç”±å™¨ - PowerShellç‰ˆ - å¢å¼ºç‰ˆ
# ç³»ç»Ÿ: windows
# å¯ç”¨å·¥å…·: ['claude', 'gemini', 'kimi', 'qwen', 'ollama', 'codebuddy', 'qodercli', 'iflow']

param(
    [string]$UserInput = ""
)

function SmartRoute {
    param([string]$Input)

    $routeKeywords = @("ç”¨", "å¸®æˆ‘", "è¯·", "æ™ºèƒ½", "ai", "å†™", "ç”Ÿæˆ", "è§£é‡Š", "åˆ†æ", "ç¿»è¯‘", "ä»£ç ", "æ–‡ç« ")

    foreach ($keyword in $routeKeywords) {
        if ($Input -like "*$keyword*") {
            return $true
        }
    }

    return $false
}

function Route-ToTool {
    param([string]$Input)

    if ($Input -like "*claude*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: Anthropic Claude"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "claude", ""        $cleanInput = $cleanInput -replace "anthropic", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        claude.cmd $cleanInput.Trim()        return
    }

    if ($Input -like "*gemini*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: Google Gemini AI"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "gemini", ""        $cleanInput = $cleanInput -replace "google", ""        $cleanInput = $cleanInput -replace "è°·æ­Œ", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        gemini.cmd $cleanInput.Trim()        return
    }

    if ($Input -like "*kimi*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: æœˆä¹‹æš—é¢Kimi"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "kimi", ""        $cleanInput = $cleanInput -replace "æœˆä¹‹æš—é¢", ""        $cleanInput = $cleanInput -replace "moonshot", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        python kimi_wrapper.py $cleanInput.Trim()        return
    }

    if ($Input -like "*qwen*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: é˜¿é‡Œé€šä¹‰åƒé—®"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "qwen", ""        $cleanInput = $cleanInput -replace "é€šä¹‰", ""        $cleanInput = $cleanInput -replace "é˜¿é‡Œ", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        qwen.cmd $cleanInput.Trim()        return
    }

    if ($Input -like "*ollama*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: Ollamaæœ¬åœ°æ¨¡å‹"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "ollama", ""        $cleanInput = $cleanInput -replace "æœ¬åœ°", ""        $cleanInput = $cleanInput -replace "ç¦»çº¿", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        ollama $cleanInput.Trim()        return
    }

    if ($Input -like "*codebuddy*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: CodeBuddyä»£ç åŠ©æ‰‹"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "codebuddy", ""        $cleanInput = $cleanInput -replace "ä»£ç åŠ©æ‰‹", ""        $cleanInput = $cleanInput -replace "ç¼–ç¨‹", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        codebuddy $cleanInput.Trim()        return
    }

    if ($Input -like "*qodercli*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: QoderCLIä»£ç ç”Ÿæˆ"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "qodercli", ""        $cleanInput = $cleanInput -replace "ä»£ç ç”Ÿæˆ", ""        $cleanInput = $cleanInput -replace "ç¼–ç¨‹", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        qodercli $cleanInput.Trim()        return
    }

    if ($Input -like "*iflow*") {
        Write-Host "ğŸš€ æ™ºèƒ½è·¯ç”±åˆ°: iFlowæ™ºèƒ½åŠ©æ‰‹"
        $cleanInput = $Input
        $cleanInput = $cleanInput -replace "iflow", ""        $cleanInput = $cleanInput -replace "æ™ºèƒ½", ""        $cleanInput = $cleanInput -replace "åŠ©æ‰‹", ""        $cleanInput = $cleanInput -replace "å¿ƒæµ", ""        $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
        iflow.cmd $cleanInput.Trim()        return
    }

    # é»˜è®¤è·¯ç”±åˆ°Anthropic Claude
    $cleanInput = $Input
    $cleanInput = $cleanInput -replace "^ç”¨", "" -replace "^å¸®æˆ‘", "" -replace "^è¯·", "" -replace "^å†™", "" -replace "^ç”Ÿæˆ", "" -replace "^è§£é‡Š", "" -replace "^åˆ†æ", "" -replace "^ç¿»è¯‘", "" -replace "^ä»£ç ", "" -replace "^æ–‡ç« ", ""
    claude.cmd $cleanInput.Trim()

}

# ä¸»é€»è¾‘
if (-not $UserInput) {{
    Write-Host "ğŸ¯ æ™ºèƒ½{cli_name}è·¯ç”±å™¨ - PowerShellç‰ˆ - å¢å¼ºç‰ˆ"
    Write-Host "ğŸ’¡ åŸå§‹åŠŸèƒ½: .\smart_{cli_name}.ps1 'å‚æ•°'"
    Write-Host "ğŸ¤– æ™ºèƒ½è·¯ç”±ç¤ºä¾‹:"
    Write-Host "     .\smart_iflow.ps1 'ç”¨claudeå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨geminiå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨kimiå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨qwenå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨ollamaå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨codebuddyå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨qodercliå†™ä»£ç '"
    Write-Host "     .\smart_iflow.ps1 'ç”¨iflowå†™ä»£ç '"
    exit
}}

if (SmartRoute $UserInput) {{
    Route-ToTool $UserInput
}} else {{
    {cli_name} $UserInput
}}
