# ç®€åŒ–ç‰ˆWikiç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ ç³»ç»Ÿå®šä½
ä¸“é—¨ä¸ºæŠ€èƒ½ååŒç¼–è¾‘è®¾è®¡çš„ç®€åŒ–Wikiç³»ç»Ÿï¼ŒåˆæœŸåªæ”¯æŒé€šè¿‡æˆ‘ä»¬çš„æŠ€èƒ½å‚ä¸ç¼–è¾‘ã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Vue.js 3 + Monaco Editor
- **åç«¯**: Node.js + Express
- **æ•°æ®åº“**: MongoDB + Redis
- **ååŒ**: Yjs + WebSocket
- **æƒé™**: JWT + RBAC

### ç³»ç»Ÿè¾¹ç•Œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç®€åŒ–Wikiç³»ç»Ÿ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  è¯æ¡ç®¡ç†    â”‚  â”‚  ååŒç¼–è¾‘    â”‚           â”‚
â”‚  â”‚             â”‚  â”‚             â”‚           â”‚
â”‚  â”‚ â€¢ åˆ›å»ºè¯æ¡   â”‚  â”‚ â€¢ å®æ—¶ç¼–è¾‘   â”‚           â”‚
â”‚  â”‚ â€¢ ç‰ˆæœ¬æ§åˆ¶   â”‚  â”‚ â€¢ å†²çªè§£å†³   â”‚           â”‚
â”‚  â”‚ â€¢ æƒé™ç®¡ç†   â”‚  â”‚ â€¢ ç”¨æˆ·çŠ¶æ€   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                â”‚                  â”‚
â”‚         â–¼                â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           æŠ€èƒ½é›†æˆå±‚                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  WikiæŠ€èƒ½    â”‚  â”‚  ç¼–è¾‘æƒé™    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  æ¥å£        â”‚  â”‚  æ§åˆ¶        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ è¯æ¡æ“ä½œ   â”‚  â”‚ â€¢ ç”¨æˆ·è®¤è¯   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å†…å®¹åŒæ­¥   â”‚  â”‚ â€¢ æƒé™éªŒè¯   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ å˜æ›´é€šçŸ¥   â”‚  â”‚ â€¢ å®¡è®¡æ—¥å¿—   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ•°æ®æ¨¡å‹

### è¯æ¡æ¨¡å‹
```javascript
const entrySchema = new mongoose.Schema({
  title: {
    type: String,
    required: true,
    unique: true
  },
  url: {
    type: String,
    required: true,
    unique: true
  },
  content: {
    type: String,
    required: true
  },
  category: {
    type: String,
    required: true
  },
  status: {
    type: String,
    enum: ['draft', 'review', 'published', 'archived'],
    default: 'draft'
  },
  collaborators: [{
    userId: String,
    userName: String,
    role: {
      type: String,
      enum: ['owner', 'editor', 'viewer'],
      default: 'viewer'
    },
    joinedAt: {
      type: Date,
      default: Date.now
    }
  }],
  versions: [{
    version: String,
    content: String,
    author: String,
    timestamp: Date,
    changes: String
  }],
  metadata: {
    createdAt: {
      type: Date,
      default: Date.now
    },
    updatedAt: {
      type: Date,
      default: Date.now
    },
    tags: [String],
    viewCount: {
      type: Number,
      default: 0
    }
  }
});
```

### ç¼–è¾‘ä¼šè¯æ¨¡å‹
```javascript
const sessionSchema = new mongoose.Schema({
  entryId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Entry',
    required: true
  },
  participants: [{
    userId: String,
    userName: String,
    socketId: String,
    cursor: {
      line: Number,
      column: Number
    },
    selection: {
      start: { line: Number, column: Number },
      end: { line: Number, column: Number }
    },
    lastActivity: {
      type: Date,
      default: Date.now
    }
  }],
  yjsState: {
    type: String,
    required: true
  },
  isActive: {
    type: Boolean,
    default: true
  },
  createdAt: {
    type: Date,
    default: Date.now
  }
});
```

## ğŸ”§ æ ¸å¿ƒAPIè®¾è®¡

### è¯æ¡ç®¡ç†API
```javascript
// åˆ›å»ºè¯æ¡
POST /api/entries
{
  "title": "æŠ€èƒ½åç§°",
  "category": "æŠ€èƒ½åˆ†ç±»",
  "content": "è¯æ¡å†…å®¹"
}

// è·å–è¯æ¡
GET /api/entries/:id

// æ›´æ–°è¯æ¡
PUT /api/entries/:id
{
  "content": "æ›´æ–°å†…å®¹",
  "changes": "å˜æ›´è¯´æ˜"
}

// è·å–è¯æ¡ç‰ˆæœ¬å†å²
GET /api/entries/:id/versions

// æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬
POST /api/entries/:id/restore/:version
```

### ååŒç¼–è¾‘API
```javascript
// åŠ å…¥ç¼–è¾‘ä¼šè¯
POST /api/sessions/:entryId/join
{
  "userId": "ç”¨æˆ·ID",
  "userName": "ç”¨æˆ·å"
}

// è·å–ä¼šè¯çŠ¶æ€
GET /api/sessions/:entryId

// åŒæ­¥ç¼–è¾‘æ“ä½œ
WebSocket /ws/sessions/:entryId
{
  "type": "operation",
  "operation": {
    "type": "insert|delete|replace",
    "position": Number,
    "content": String
  },
  "userId": "ç”¨æˆ·ID"
}
```

### æƒé™æ§åˆ¶API
```javascript
// æ·»åŠ åä½œè€…
POST /api/entries/:id/collaborators
{
  "userId": "ç”¨æˆ·ID",
  "userName": "ç”¨æˆ·å",
  "role": "editor"
}

// æ›´æ–°æƒé™
PUT /api/entries/:id/collaborators/:userId
{
  "role": "editor"
}

// ç§»é™¤åä½œè€…
DELETE /api/entries/:id/collaborators/:userId
```

## ğŸš€ æŠ€èƒ½é›†æˆæ¥å£

### WikiæŠ€èƒ½æ¥å£
```javascript
class WikiSkillInterface {
  // å‚ä¸è¯æ¡åˆ›å»º
  async createEntry(title, category, initialContent) {
    const response = await fetch('/api/entries', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.token}`
      },
      body: JSON.stringify({
        title,
        category,
        content: initialContent
      })
    });
    
    return response.json();
  }
  
  // å‚ä¸ååŒç¼–è¾‘
  async joinEditSession(entryUrl) {
    const entryId = this.extractEntryId(entryUrl);
    
    // å»ºç«‹WebSocketè¿æ¥
    const socket = io(`/ws/sessions/${entryId}`);
    
    // å¤„ç†ç¼–è¾‘æ“ä½œ
    socket.on('operation', (operation) => {
      this.handleRemoteOperation(operation);
    });
    
    return socket;
  }
  
  // æäº¤ç¼–è¾‘å†…å®¹
  async submitEdit(entryUrl, content, changes) {
    const entryId = this.extractEntryId(entryUrl);
    
    const response = await fetch(`/api/entries/${entryId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.token}`
      },
      body: JSON.stringify({
        content,
        changes
      })
    });
    
    return response.json();
  }
  
  // è·å–è¯æ¡ä¿¡æ¯
  async getEntryInfo(entryUrl) {
    const entryId = this.extractEntryId(entryUrl);
    
    const response = await fetch(`/api/entries/${entryId}`, {
      headers: {
        'Authorization': `Bearer ${this.token}`
      }
    });
    
    return response.json();
  }
  
  private extractEntryId(url) {
    // ä»URLä¸­æå–è¯æ¡ID
    const match = url.match(/\/entries\/([a-f0-9]{24})/);
    return match ? match[1] : null;
  }
  
  private handleRemoteOperation(operation) {
    // å¤„ç†è¿œç¨‹ç¼–è¾‘æ“ä½œ
    switch (operation.type) {
      case 'insert':
        this.editor.insert(operation.position, operation.content);
        break;
      case 'delete':
        this.editor.delete(operation.position, operation.length);
        break;
      case 'replace':
        this.editor.replace(operation.position, operation.length, operation.content);
        break;
    }
  }
}
```

## ğŸ”’ æƒé™æ§åˆ¶æœºåˆ¶

### è®¿é—®æ§åˆ¶
```javascript
class AccessController {
  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®è¯æ¡
  async checkEntryAccess(userId, entryId, action) {
    const entry = await Entry.findById(entryId);
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯åä½œè€…
    const collaborator = entry.collaborators.find(
      c => c.userId === userId
    );
    
    if (!collaborator) {
      throw new Error('ç”¨æˆ·æ— æƒè®¿é—®æ­¤è¯æ¡');
    }
    
    // æ£€æŸ¥æ“ä½œæƒé™
    const permissions = {
      'owner': ['read', 'write', 'delete', 'manage'],
      'editor': ['read', 'write'],
      'viewer': ['read']
    };
    
    if (!permissions[collaborator.role].includes(action)) {
      throw new Error('ç”¨æˆ·æƒé™ä¸è¶³');
    }
    
    return true;
  }
  
  // æ·»åŠ åä½œè€…
  async addCollaborator(entryId, userId, role, requesterId) {
    // æ£€æŸ¥è¯·æ±‚è€…æ˜¯å¦æœ‰ç®¡ç†æƒé™
    await this.checkEntryAccess(requesterId, entryId, 'manage');
    
    const entry = await Entry.findById(entryId);
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»æ˜¯åä½œè€…
    if (entry.collaborators.find(c => c.userId === userId)) {
      throw new Error('ç”¨æˆ·å·²ç»æ˜¯åä½œè€…');
    }
    
    // æ·»åŠ åä½œè€…
    entry.collaborators.push({
      userId,
      userName: await this.getUserName(userId),
      role
    });
    
    await entry.save();
    
    return entry;
  }
}
```

## ğŸ“± ç”¨æˆ·ç•Œé¢è®¾è®¡

### è¯æ¡ç¼–è¾‘ç•Œé¢
```html
<div class="wiki-editor">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <div class="editor-toolbar">
    <div class="toolbar-left">
      <h1 class="entry-title" contenteditable="true">{{ entry.title }}</h1>
      <span class="entry-status">{{ entry.status }}</span>
    </div>
    
    <div class="toolbar-right">
      <button class="btn-save" @click="save">ä¿å­˜</button>
      <button class="btn-preview" @click="preview">é¢„è§ˆ</button>
      <button class="btn-publish" @click="publish">å‘å¸ƒ</button>
      
      <div class="active-users">
        <div v-for="user in activeUsers" 
             :key="user.userId" 
             class="user-avatar"
             :style="{backgroundColor: user.color}">
          {{ user.userName.charAt(0) }}
        </div>
      </div>
    </div>
  </div>
  
  <!-- ä¸»ç¼–è¾‘åŒºåŸŸ -->
  <div class="editor-main">
    <div class="editor-pane">
      <div id="monaco-editor" class="monaco-editor"></div>
    </div>
    
    <div class="sidebar">
      <!-- åä½œè€…åˆ—è¡¨ -->
      <div class="collaborators">
        <h3>åä½œè€…</h3>
        <div v-for="collaborator in entry.collaborators" 
             :key="collaborator.userId"
             class="collaborator-item">
          <span class="collaborator-name">{{ collaborator.userName }}</span>
          <span class="collaborator-role">{{ collaborator.role }}</span>
        </div>
      </div>
      
      <!-- ç‰ˆæœ¬å†å² -->
      <div class="version-history">
        <h3>ç‰ˆæœ¬å†å²</h3>
        <div v-for="version in entry.versions" 
             :key="version.version"
             class="version-item">
          <span class="version-number">{{ version.version }}</span>
          <span class="version-author">{{ version.author }}</span>
          <span class="version-time">{{ formatTime(version.timestamp) }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
```

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### Dockeré…ç½®
```yaml
version: '3.8'

services:
  wiki-frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://wiki-backend:3001
    depends_on:
      - wiki-backend

  wiki-backend:
    build: ./backend
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - MONGODB_URI=mongodb://mongodb:27017/wiki
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your-secret-key
    depends_on:
      - mongodb
      - redis

  mongodb:
    image: mongo:6.0
    ports:
      - "27017:27017"
    volumes:
      - wiki_mongodb_data:/data/db

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - wiki_redis_data:/data

volumes:
  wiki_mongodb_data:
  wiki_redis_data:
```

---

**è®¾è®¡å›¢é˜Ÿ**ï¼šWikiç³»ç»Ÿè®¾è®¡å›¢é˜Ÿ  
**è®¾è®¡æ—¥æœŸ**ï¼š2025å¹´12æœˆ14æ—¥  
**ç‰ˆæœ¬**ï¼šv1.0