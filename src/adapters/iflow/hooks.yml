# iFlow CLI Official Hook Configuration File
# Configuration based on 9 Hook types from iFlow CLI official documentation

# Cross-CLI Integration System Configuration
cross_cli_integration:
  enabled: true
  adapter: "IFlowOfficialHookAdapter"
  version: "1.0.0"

# iFlow Official Hook Configuration
hooks:
  # 1. PreToolUse - Triggered before tool execution
  PreToolUse:
    - matcher: "*"  # Match all tools
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter PreToolUse"
          timeout: 30
          description: "Detect cross-CLI call intents and tool interception"
    - matcher: "Edit|Write|Replace"  # Specifically match file editing tools
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter PreToolUse"
          timeout: 15
          description: "Cross-CLI detection for file editing tools"

  # 2. PostToolUse - Triggered after tool execution
  PostToolUse:
    - matcher: "*"
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter PostToolUse"
          timeout: 15
          description: "Tool execution result processing"

  # 3. SetUpEnvironment - Triggered when setting up environment
  SetUpEnvironment:
    - hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter SetUpEnvironment"
          timeout: 30
          description: "Initialize cross-CLI environment"

  # 4. Stop - Triggered when main session ends
  Stop:
    - hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter Stop"
          timeout: 10
          description: "Clean up cross-CLI resources"

  # 5. SubagentStop - Triggered when sub-agent session ends
  SubagentStop:
    - hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter SubagentStop"
          timeout: 10
          description: "Clean up sub-agent resources"

  # 6. SessionStart - Triggered when session starts
  SessionStart:
    - matcher: "startup|resume"  # Match new startup and resumed sessions
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter SessionStart"
          timeout: 15
          description: "Cross-CLI environment setup when session starts"
    - matcher: "clear|compress"  # Match clearing and compression sessions
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter SessionStart"
          timeout: 10
          description: "Processing of special session types"

  # 7. SessionEnd - Triggered when session ends
  SessionEnd:
    - hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter SessionEnd"
          timeout: 15
          description: "Cross-CLI summary when session ends"

  # 8. UserPromptSubmit - Triggered when user prompt is submitted
  UserPromptSubmit:
    - matcher: ".*"  # Match all user prompts
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter UserPromptSubmit"
          timeout: 30
          description: "Core cross-CLI call detection"
    - matcher: ".*claude.*|.*gemini.*|.*qwencode.*|.*qoder.*|.*codebuddy.*|.*codex.*"
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter UserPromptSubmit"
          timeout: 45
          description: "Priority processing of prompts containing CLI names"

  # 9. Notification - Triggered when notification is sent
  Notification:
    - matcher: ".*"  # Match all notifications
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter Notification"
          timeout: 10
          description: "Cross-CLI status notifications"
    - matcher: ".*permission.*|.*error.*|.*warning.*"
      hooks:
        - type: "command"
          command: "python -m src.adapters.iflow.official_hook_adapter Notification"
          timeout: 5
          description: "Special processing of important notifications"

    # Plugin Configuration
    config:
      # Cross-CLI Feature Configuration
      cross_cli_enabled: true
      collaboration_mode: "active"  # active, passive, disabled
      auto_detection: true

      # Performance Configuration
      timeout: 30
      max_concurrent_calls: 5
      retry_count: 3
      retry_delay: 1

      # Error Handling Configuration
      error_handling: "continue"   # continue, abort, fallback
      fallback_to_iflow: true
      show_error_details: true

      # Collaboration Configuration
      collaboration_enabled: true
      project_spec_enabled: true
      auto_collaboration: false

      # Event Configuration
      event_bus_enabled: true
      event_logging: true
      performance_monitoring: true

# Hook Event Configuration
hook_events:
  # User Input Events
  on_user_input:
    description: "Triggered on user input, used to detect cross-CLI call intents"
    priority: 100
    async: true
    timeout: 10

  # Command Lifecycle Events
  on_command_start:
    description: "Triggered when command starts executing"
    priority: 90
    async: true
    timeout: 5

  on_command_end:
    description: "Triggered when command execution completes"
    priority: 90
    async: true
    timeout: 5

  # Workflow Events
  on_workflow_stage:
    description: "Triggered when workflow stage executes"
    priority: 80
    async: true
    timeout: 15

  on_pipeline_execute:
    description: "Triggered when pipeline executes"
    priority: 70
    async: true
    timeout: 20

  # Error Handling Events
  on_error:
    description: "Triggered when error occurs"
    priority: 95
    async: true
    timeout: 5

  # Output Processing Events
  on_output_render:
    description: "Triggered when output renders"
    priority: 60
    async: true
    timeout: 10

# Collaboration Protocol Configuration
collaboration_protocols:
  # Chinese Protocols
  chinese:
    - pattern: "请用{cli}帮我{task}"
      priority: 100
    - pattern: "调用{cli}来{task}"
      priority: 95
    - pattern: "用{cli}帮我{task}"
      priority: 90
    - pattern: "让{cli}帮我{task}"
      priority: 85
    - pattern: "启动{cli}工作流{task}"
      priority: 80
    - pattern: "通过{cli}执行{task}"
      priority: 75

  # English Protocols
  english:
    - pattern: "use {cli} to {task}"
      priority: 100
    - pattern: "call {cli} to {task}"
      priority: 95
    - pattern: "ask {cli} for {task}"
      priority: 90
    - pattern: "start {cli} workflow for {task}"
      priority: 85
    - pattern: "execute {task} with {cli}"
      priority: 80
    - pattern: "process {task} using {cli}"
      priority: 75

# Supported CLI Tools
supported_clis:
  - name: "claude"
    display_name: "Claude CLI"
    description: "Anthropic Claude CLI Tool"
    integration_type: "hook"

  - name: "gemini"
    display_name: "Gemini CLI"
    description: "Google Gemini CLI Tool"
    integration_type: "extension"

  - name: "qwencode"
    display_name: "QwenCode CLI"
    description: "Alibaba QwenCode CLI Tool"
    integration_type: "inheritance"

  - name: "qoder"
    display_name: "Qoder CLI"
    description: "Qoder Programming Assistant CLI Tool"
    integration_type: "plugin"

  - name: "codebuddy"
    display_name: "CodeBuddy CLI"
    description: "CodeBuddy Programming Assistant CLI Tool"
    integration_type: "buddy"

  - name: "codex"
    display_name: "Codex CLI"
    description: "OpenAI Codex CLI Tool"
    integration_type: "extension"

# Event Bus Configuration
event_bus:
  enabled: true
  buffer_size: 1000
  async_dispatch: true

  # Event Listeners
  listeners:
    - event: "cross_cli_detected"
      handler: "handle_cross_cli_detected"
      async: true

    - event: "workflow_started"
      handler: "handle_workflow_started"
      async: true

    - event: "workflow_completed"
      handler: "handle_workflow_completed"
      async: true

    - event: "error_occurred"
      handler: "handle_error_occurred"
      async: true

# Performance Monitoring Configuration
performance_monitoring:
  enabled: true
  metrics:
    - "hook_execution_time"
    - "cross_cli_call_count"
    - "success_rate"
    - "error_count"
    - "response_time"

  # Report Configuration
  reporting:
    interval: 60  # seconds
    log_file: "~/.config/iflow/logs/performance.log"
    max_file_size: "10MB"

# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

  # Log Files
  handlers:
    - type: "file"
      filename: "~/.config/iflow/logs/hooks.log"
      max_size: "20MB"
      backup_count: 5

    - type: "console"
      enabled: true

# Security Configuration
security:
  # Input Validation
  input_validation:
    enabled: true
    max_length: 10000
    sanitize_html: true

  # Permission Check
  permission_check:
    enabled: true
    check_file_access: true

  # Audit Logs
  audit_logging:
    enabled: true
    log_file: "~/.config/iflow/logs/audit.log"

# Cache Configuration
cache:
  enabled: true
  ttl: 300  # 5 minutes
  max_size: "100MB"

  # Cache Strategies
  strategies:
    - "result_cache"      # Result Cache
    - "adapter_cache"     # Adapter Cache
    - "config_cache"      # Configuration Cache