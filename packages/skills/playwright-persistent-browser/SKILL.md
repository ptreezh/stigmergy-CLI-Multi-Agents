---
name: playwright-persistent-browser
description: 使用Playwright进行持久化浏览器操作，支持自动检测登录状态、手动登录流程、会话保存和复用。当需要访问需要登录的网站或进行复杂的浏览器操作时使用。禁止使用无头浏览器。
allowed-tools: Read, Write, Edit, Bash, Glob, Grep
---

# Playwright 持久化浏览器 Skill

## 功能概述
这个Skill提供了完整的Playwright持久化浏览器解决方案，能够：
- 自动检测网站登录状态
- 处理需要手动登录的情况
- 保存和复用浏览器会话
- 在需要时重启浏览器并验证登录状态
- 执行各种浏览器自动化任务

## 核心工作流程

### 1. 访问网站并检测登录状态
- 使用Playwright打开指定网站
- 检查是否需要登录（通过选择器、URL或其他标识）
- 如果已登录，直接执行任务

### 2. 处理登录需求
- 如果检测到需要登录：
  1. 根据模板创建持久化登录脚本
  2. 启动有头浏览器等待手动登录
  3. 登录完成后保存会话状态
  4. 关闭当前浏览器实例
  5. 重新启动浏览器并验证登录状态
  6. 继续执行后续任务

### 3. 任务执行
- 在成功登录的状态下执行用户指定的操作
- 支持各种网页交互（点击、输入、导航等）

## 使用方法

### 基本用法
```
请帮我访问 [网站URL]，检查登录状态，如果需要登录请协助我处理登录流程，然后执行 [具体任务]
```

### 示例请求
```
请帮我访问GitHub，检查是否登录，如果未登录请等待我手动登录，然后获取我的repositories列表
```

```
请帮我访问淘宝，检查登录状态，处理登录后搜索"iPhone 15"并获取前5个商品信息
```

## 文件结构

### 核心文件
- `SKILL.md` - Skill定义文件
- `package.json` - 项目依赖配置
- `config.json` - 浏览器和站点配置
- `requirements.txt` - Python依赖（如需要）

### 脚本文件
- `my-launcher.js` - 浏览器启动器
- `run-task.js` - 主任务执行脚本
- `task-template.js` - 通用任务模板
- `login-handler.js` - 登录处理脚本
- `session-manager.js` - 会话管理脚本

### 支持文件
- `my-playwright-session/` - 会话数据目录
- `examples/` - 示例脚本目录
- `templates/` - 模板文件目录

## 配置说明

### 浏览器配置
- 支持Chromium浏览器
- 禁用无头模式（必须显示浏览器界面）
- 自动管理用户数据目录
- 支持自定义窗口大小和启动参数

### 站点配置
- 支持多站点配置
- 可配置登录检测选择器
- 支持自定义超时时间
- 可配置登录后验证方式

## 使用限制

⚠️ **重要限制**：
1. **禁止使用无头浏览器** - 必须显示浏览器界面
2. 仅支持Chromium浏览器
3. 会话文件同一时间只能被一个进程使用
4. 需要手动安装Playwright浏览器：`npm run install-browsers`

## 错误处理

### 常见问题及解决方案
1. **浏览器启动失败** → 运行 `npm run install-browsers`
2. **会话被锁定** → 检查其他进程或重启系统
3. **登录状态丢失** → 删除会话目录重新登录
4. **权限问题** → 确保有写入会话目录的权限

## 安全注意事项

1. 会话数据包含敏感信息（Cookie、Token等）
2. 不要在公共环境中共享会话目录
3. 定期清理过期的会话数据
4. 注意保护个人隐私信息

## 扩展功能

### 支持的操作类型
- 页面导航和等待
- 元素查找和交互
- 表单填写和提交
- 截图和页面内容提取
- 文件上传和下载
- 多标签页管理

### 高级特性
- 自动等待页面加载完成
- 智能重试机制
- 详细的日志记录
- 会话自动备份和恢复

## 最佳实践

1. **明确指定目标** - 清楚说明要访问的网站和执行的任务
2. **提供登录信息** - 如果需要登录，提前准备好账号信息
3. **分步骤执行** - 复杂任务分解为多个小步骤
4. **验证结果** - 关键操作后验证是否成功
5. **处理异常** - 预见可能的登录问题和网络异常

## 技术依赖

### 核心依赖
- Playwright (^1.40.0)
- Node.js (支持ES modules)

### 可选依赖
- rimraf (用于清理会话)

## 安装和设置

首次使用前需要：
1. 安装依赖：`npm install`
2. 安装浏览器：`npm run install-browsers`
3. 配置站点信息：编辑 `config.json`

## 示例脚本

查看 `examples/` 目录中的完整示例：
- GitHub登录和仓库获取
- 电商网站登录和商品搜索
- 社交媒体操作示例